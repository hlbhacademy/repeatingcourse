
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>113-2 é‡è£œä¿®èª²ç¨‹æŸ¥è©¢æ—¥æ›†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 1em; }
    #calendar { max-width: 1100px; margin: auto; }
    .fc-event.critical { background-color: #ffdddd !important; }
    .fc-event.changed { border: 2px solid red !important; }
  </style>
</head>
<body>
  <h2>ğŸ“… 113-2 é‡è£œä¿®èª²ç¨‹æŸ¥è©¢æ—¥æ›†</h2>
  <div id="calendar"></div>

  <script>
    const apiUrl = "https://script.google.com/macros/s/AKfycbxbpuFcInB-xFFGSVJReKEbp2DE5k8mDs8aKx80o94_fICApzgZ7_RI-j2kbDikG0jo/exec";

    document.addEventListener('DOMContentLoaded', async function () {
      const res = await fetch(apiUrl);
      const data = await res.json();

const events = data.map(item => {
  // ä¿éšªè™•ç†ã€Œæ—¥æœŸã€å¸¶ Tï¼ˆä¾‹å¦‚ 2025-04-10T00:00:00.000Zï¼‰æ™‚åªå–å‰åŠéƒ¨
  let date = item["æ—¥æœŸ"];
  if (typeof date === "string" && date.includes("T")) {
    date = date.split("T")[0];
  }
  const start = `${date}T${item["èµ·å§‹æ™‚é–“"]}`;
  const end = `${date}T${item["çµæŸæ™‚é–“"]}`;
  const color = getColorByName(item["èª²ç¨‹åç¨±"]);
  return {
    title: `${item["èª²ç¨‹åç¨±"]}ï¼ˆ${item["æ•™å¸«"]}ï¼${item["æ•™å®¤"]}ï¼‰`,
    start,
    end,
    backgroundColor: color,
    classNames: getClass(item),
    extendedProps: item
  };
});


      const calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
        initialView: 'dayGridMonth',
        locale: 'zh-tw',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,listWeek'
        },
        events,
        eventDidMount: function(info) {
          const p = info.event.extendedProps;
          const tooltip = `æ•™å¸«ï¼š${p["æ•™å¸«"]}\næ•™å®¤ï¼š${p["æ•™å®¤"]}\nå ‚æ•¸ï¼š${p["ç•¶å‰å ‚æ•¸"]}/${p["ç¸½å ‚æ•¸"]}\nå‚™è¨»ï¼š${p["å‚™è¨»"]}`;
          info.el.title = tooltip;
        }
      });

      calendar.render();
    });

    function getColorByName(name) {
      const colors = ['#FFB6C1','#90EE90','#87CEFA','#FFD700','#FFA07A','#9370DB','#FF8C00','#20B2AA'];
      let hash = 0;
      for (let i = 0; i < name.length; i++) hash += name.charCodeAt(i);
      return colors[hash % colors.length];
    }

    function getClass(item) {
      const result = [];
      if (Number(item["ç•¶å‰å ‚æ•¸"]) >= Math.ceil(Number(item["ç¸½å ‚æ•¸"]) / 3)) result.push("critical");
      return result;
    }
  </script>
</body>
</html>
